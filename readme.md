# Application

This documentation covers the deployment of a Flask application using Docker, Terraform for Azure infrastructure provisioning, and Helm for Kubernetes deployment management.

## Table of Contents

1. Docker Deployment
2. Terraform Setup
3. Kubernetes and Helm Deployment


## Application and Database App.py

Application Setup
The application uses Flask to create a simple web server with a route that reverses client IP addresses and stores them in a SQLite database.

Database Initialization
A SQLite database ips.db is initialized with a table reversed_ips to store the IP addresses:

- id: Auto-incremented primary key.
- ip: Reversed IP address.

Flask Route
The application defines one route (/) that:

1. Retrieves the client's IP address.
2. Reverses the IP address.
3. Stores the reversed IP in the database.
4. Returns the reversed IP to the client.

Running the Application
The Flask application is set to run on host='0.0.0.0' and port=5000, allowing it to be accessible over the network.

## Docker Deployment

### Building the Docker Image

Ensure your Dockerfile is set up correctly. The build is a simple python deployment.


### Building the Docker Image and Pushing to DockerHub
To build the Docker image and push it to DockerHub, follow these steps:
1. Make sure you have Docker installed on your machine.
2. Open a terminal and navigate to the root directory of your Flask application.
3. Run the following command to build the Docker image:
  ```bash
  docker build -t your-dockerhub-username/your-image-name:tag .
  ```
  Replace `your-dockerhub-username` with your DockerHub username, `your-image-name` with the desired name for your image, and `tag` with the desired tag (e.g., `latest`).
4. After the build is complete, you can verify that the image was created by running `docker images`.
5. To push the image to DockerHub, run the following command:
  ```bash
  docker push your-dockerhub-username/your-image-name:tag
  ```
  Replace `your-dockerhub-username`, `your-image-name`, and `tag` with the same values used in the previous step.
6. Once the push is complete, you can verify that the image is available on DockerHub by visiting your DockerHub repository.

# Terraform Configuration Files

## main.tf:

This file contains the Terraform configuration for creating an Azure Kubernetes Service (AKS) cluster. It includes the following resources:

- `random_pet.rg_name`: Generates a random name for the resource group.
- `azurerm_resource_group.rg`: Creates an Azure resource group using the random name generated by `random_pet.rg_name`.
- `azurerm_kubernetes_cluster.k8s`: Creates an AKS cluster in the resource group, using the generated resource group name and other specified configurations.

The AKS cluster is configured with the following settings:

- `default_node_pool`: Defines the default node pool for the cluster, including the name, VM size, and node count.
- `identity`: Enables system-assigned identity for the cluster.
- `linux_profile`: Specifies the Linux profile for the cluster, including the admin username and SSH key.
- `network_profile`: Configures the network settings for the cluster, including the network plugin and load balancer SKU.

## Initialize and Apply Terraform

To use this Terraform configuration, follow these steps:

1. Run `terraform init` to initialize the Terraform working directory. 
2. Run `terraform plan` to view planned changes and `terraform apply` to create or update the Azure resources defined in the configuration.

Make sure you have the necessary permissions and credentials to create resources in your Azure subscription.



## Helm Deployment
### Generating Helm Charts
Helm charts are currently in deel directory

To deploy the Flask application to Kubernetes using Helm, follow these steps:
1. Create a new directory for the Helm charts: `mkdir deel`.
2. Change into the newly created directory: `cd deel`.
3. Run `helm create myapp` to generate the basic structure for the Helm chart.
4. Update the `values.yaml` file in the `deel` directory with the necessary configurations for your application.
5. Customize the `templates` directory in the `deel` chart to include the required Kubernetes manifests for your application.
6. Run `helm package deel` to package the Helm chart.
7. Run `helm install myapp myapp-0.1.0.tgz` to install the Helm chart on your Kubernetes cluster.

Once the Helm chart is installed, you can manage the deployment, scaling, and updates of your Flask application using Helm commands.

For more information on Helm and Helm charts, refer to the official Helm documentation.